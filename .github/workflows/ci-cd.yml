# 4️⃣ Deploy to EC2
- name: Deploy to EC2
  uses: appleboy/scp-action@v0.1.1
  with:
    host: ${{ secrets.EC2_HOST }}
    username: ${{ secrets.EC2_USER }}
    key: ${{ secrets.EC2_SSH_KEY }}
    port: 22
    source: "target/*.jar"       # From GitHub runner
    target: "~/ci-cd-demo/"     # On EC2

- name: Start app on EC2
  uses: appleboy/ssh-action@v0.1.9
  with:
    host: ${{ secrets.EC2_HOST }}
    username: ${{ secrets.EC2_USER }}
    key: ${{ secrets.EC2_SSH_KEY }}
    port: 22
    script: |
      cd ~/ci-cd-demo
      # Stop previous app
      pkill -f 'java -jar .*ci-cd-demo.*\.jar' || true
      # Start new app
      nohup java -jar *.jar > app.log 2>&1 &
